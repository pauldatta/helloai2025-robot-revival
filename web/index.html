<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aum's Journey - Control Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
        }
        .navbar {
            background-color: #1f1f1f;
        }
        #log-container {
            height: 75vh;
            background-color: #1e1e1e;
            border: 1px solid #333;
            border-radius: 5px;
            overflow-y: scroll;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            padding: 15px;
        }
        .log-message {
            white-space: pre-wrap;
            margin-bottom: 5px;
        }
        .log-error { color: #ff5c5c; }
        .log-director { color: #5c8aff; }
        .log-orchestrator { color: #ff9f5c; }
        .log-hardware { color: #5cff9f; }
        .log-emulator { color: #a95cff; }
        .controls {
            background-color: #1f1f1f;
            padding: 20px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">Aum's Journey - Control Panel</span>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-8">
                <h5>Real-time Log Stream</h5>
                <div id="log-container"></div>
            </div>
            <div class="col-md-4">
                <h5>Controls</h5>
                <div class="controls">
                    <button id="stop-button" class="btn btn-danger w-100">Emergency Stop</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const logContainer = document.getElementById('log-container');
        const stopButton = document.getElementById('stop-button');
        let socket;

        function connect() {
            socket = new WebSocket(`ws://${window.location.host}/ws/logs`);

            socket.onopen = function(event) {
                console.log("WebSocket connected.");
                const logElement = document.createElement('div');
                logElement.className = 'log-message';
                logElement.style.color = '#28a745'; // Green for connection success
                logElement.textContent = '[SYSTEM] Connected to log stream.';
                logContainer.appendChild(logElement);
                logContainer.scrollTop = logContainer.scrollHeight;
            };

            socket.onmessage = function(event) {
                const message = event.data;
                const logElement = document.createElement('div');
                logElement.className = 'log-message';

                if (message.includes('[DIRECTOR]')) {
                    logElement.classList.add('log-director');
                } else if (message.includes('[ORCHESTRATOR]')) {
                    logElement.classList.add('log-orchestrator');
                } else if (message.includes('[HARDWARE]')) {
                    logElement.classList.add('log-hardware');
                } else if (message.includes('[EMU]')) {
                    logElement.classList.add('log-emulator');
                } else if (message.includes('ERROR')) {
                    logElement.classList.add('log-error');
                }

                logElement.textContent = message;
                logContainer.appendChild(logElement);
                logContainer.scrollTop = logContainer.scrollHeight; // Auto-scroll
            };

            socket.onclose = function(event) {
                console.log("WebSocket disconnected. Retrying in 2 seconds...");
                const logElement = document.createElement('div');
                logElement.className = 'log-message';
                logElement.style.color = '#ffc107'; // Yellow for disconnection
                logElement.textContent = '[SYSTEM] Disconnected. Attempting to reconnect...';
                logContainer.appendChild(logElement);
                logContainer.scrollTop = logContainer.scrollHeight;
                setTimeout(connect, 2000);
            };

            socket.onerror = function(error) {
                console.error("WebSocket error:", error);
            };
        }

        stopButton.onclick = function() {
            // Placeholder for future functionality
            alert('Emergency Stop clicked! (Functionality to be implemented)');
        };

        // Initial connection
        connect();
    </script>
</body>
</html>
